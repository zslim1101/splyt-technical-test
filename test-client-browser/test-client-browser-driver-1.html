<!doctype html>
<html>
  <head>
    <title>Socket.IO Test Driver 1</title>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      h1 {
        color: #333;
      }
      #status {
        padding: 10px 15px;
        border-radius: 5px;
        margin-bottom: 20px;
        font-weight: bold;
      }
      #status.connected {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      #status.disconnected {
        background: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      #events {
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .event-item {
        border-left: 4px solid #007bff;
        padding: 15px;
        margin-bottom: 15px;
        background: #f8f9fa;
        border-radius: 4px;
        animation: slideIn 0.3s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
      .event-time {
        color: #6c757d;
        font-size: 0.85em;
        margin-bottom: 8px;
      }
      .event-data {
        font-family: "Courier New", monospace;
        background: #fff;
        padding: 10px;
        border-radius: 4px;
        white-space: pre-wrap;
        word-break: break-word;
      }
      .no-events {
        text-align: center;
        color: #6c757d;
        padding: 40px;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <h1>Socket.IO Test - Driver 1 Location Events</h1>
    <div id="status" class="disconnected">Disconnected</div>
    <div id="events">
      <div class="no-events">Waiting for events...</div>
    </div>

    <script>
      const socket = io("http://localhost:8080", {
        path: "/subscribe",
      });
      const statusEl = document.getElementById("status");
      const eventsEl = document.getElementById("events");

      const driverIdToSubscribe = "driver_001";
      socket.on("connect", () => {
        console.log("Connected! Socket ID:", socket.id);
        statusEl.textContent = `Connected (Socket ID: ${socket.id})`;
        statusEl.className = "connected";
        socket.emit("subscribe", {
          driver_id: driverIdToSubscribe,
          since: "2024-01-01T00:00:00Z",
        });
      });

      socket.on("disconnect", () => {
        statusEl.textContent = "Disconnected";
        statusEl.className = "disconnected";
      });

      socket.on("driver_location", (data) => {
        console.log("Received event:", data);

        // Remove "no events" message if it exists
        const noEvents = eventsEl.querySelector(".no-events");
        if (noEvents) {
          noEvents.remove();
        }

        // Create event item
        const eventItem = document.createElement("div");
        eventItem.className = "event-item";

        const timeEl = document.createElement("div");
        timeEl.className = "event-time";
        timeEl.textContent = new Date().toLocaleTimeString();

        const dataEl = document.createElement("div");
        dataEl.className = "event-data";
        dataEl.textContent = JSON.stringify(data, null, 2);

        eventItem.appendChild(timeEl);
        eventItem.appendChild(dataEl);

        // Add to top of events list
        eventsEl.insertBefore(eventItem, eventsEl.firstChild);

        // Keep only last 20 events
        const items = eventsEl.querySelectorAll(".event-item");
        if (items.length > 20) {
          items[items.length - 1].remove();
        }
      });
    </script>
  </body>
</html>
